---
description: "日志规范"
alwaysApply: true
---

# 日志规范

## 核心原则
- 使用项目统一的日志模块（参考 `logger.py`）
- 在请求入口设置上下文（request_id/session_id/user_id）便于追踪
- 控制台输出易读格式，文件输出 JSON 格式
- 错误单独记录到独立的错误日志文件

## 日志级别使用
- **DEBUG**：仅开发环境，详细调试信息
- **INFO**：正常操作，关键业务流程
- **WARNING**：潜在问题，不影响正常运行
- **ERROR**：错误情况，需要关注（必须包含堆栈）
- **CRITICAL**：严重错误，系统可能无法继续运行

## 上下文追踪
- 请求开始时设置追踪上下文（request_id、session_id、user_id）
- 后续日志自动包含上下文信息，便于问题排查
- 日志格式应包含：时间戳、级别、上下文 ID、模块位置、消息

## 结构化日志
- 使用 extra 字段添加结构化数据（耗时、操作类型等）
- 便于日志聚合和分析

## 最佳实践
- 日志消息包含足够的上下文信息（如 `task_id=xxx`）
- 记录异常时必须包含堆栈信息
- 记录关键操作的开始和结束
- 使用性能监控工具记录耗时操作

## 禁止事项
- ❌ 记录敏感信息（密码、token、API key）
- ❌ 在循环中过度记录
- ❌ 使用 `print()` 代替日志
- ❌ 吞异常不记录
