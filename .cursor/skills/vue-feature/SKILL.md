---
name: vue-feature
description: 按本仓库前端约定实现 Vue/TypeScript 功能增量（组件、路由、Pinia store、API 层、类型同步）。用于新增页面/组件、修改交互、接入后端接口、修复前端 bug 时。
---

# vue-feature

## 适用场景（触发词）

- 新增/改造 **Vue 页面/组件**（`*.vue`）
- 新增/改造 **路由**（页面入口、参数、导航）
- 新增/改造 **store**（状态、缓存、会话、消息流）
- 新增/改造 **前端 API 层**（请求封装、模型、实时/流式）
- **类型同步**：更新 `frontend/src/types/` 与接口返回对齐

## 强约束（必须遵守）

- **先找现有范式再动手**：优先复用已有组件/Composable/store 的写法与命名
- **改动要成组**：组件变更 ↔ store/action ↔ API 模块 ↔ types（缺一不可）
- **类型优先**：不要用 `any` 逃避；能收敛就收敛
- **最小影响面**：避免全局重构；只改必要路径与调用链
- **敏感信息**：不要在前端写入 token/key；认证信息只通过既有机制注入

## 输入信息（缺少就先补齐）

如果用户没说清楚，先补齐：

- **UI/交互**：页面/组件位置、布局要点、交互流程、空态/错误态
- **数据契约**：请求参数、响应结构、分页/流式/实时需求
- **状态边界**：哪些放局部 state，哪些进 store（缓存策略、刷新策略）
- **路由**：路径、参数、权限/可见性（如果有）

## 工作流（按顺序执行）

### 1) 定位改动链路（先画最短路径）

- UI 入口：`frontend/src/views/**` 或 `frontend/src/components/**`
- 状态层：`frontend/src/stores/**`
- API 层：`frontend/src/api/**`
- 类型：`frontend/src/types/**`
- 路由：`frontend/src/router/index.ts`

### 2) 先更新 types（契约先行）

- 为新增/修改的接口与状态定义类型（请求、响应、核心实体）
- 如果有实时/流式消息，补齐事件/消息 union 类型与字段注释（尽量自解释）

### 3) 再更新 API 层（单一入口）

- 在 `frontend/src/api/` 新增或扩展模块方法
- 处理错误：返回结构化错误或抛出可识别异常（与现有调用方式一致）
- 若涉及 SSE/WebSocket/Realtime，优先复用既有 `realtime` 模块与 composable

### 4) 再更新 store（状态与副作用集中）

- 新增 state、getter、actions（命名与现有风格一致）
- 把网络请求与缓存策略放到 actions，组件只负责触发与展示
- 处理并发：同一 action 需要考虑重复触发、取消、过期响应覆盖等

### 5) 最后更新 UI（组件尽量“瘦”）

- 组件只做：渲染、事件绑定、最少的本地 UI state
- 增加：loading/empty/error 三态
- 确保关键交互有可见反馈（按钮禁用、提示文案、占位）

## 输出要求（交付物清单）

每次使用本 Skill，最终输出必须包含：

- **变更文件列表**（路径）
- **行为变化说明**：用户能看到的变化（1-3 条）
- **验证方式**：手动操作路径（页面入口/按钮/预期结果），必要时附请求样例

## 常见坑（避免）

- 只改组件不改 store → 状态与副作用分散，后续难维护
- 类型不更新 → 编译通过但运行期炸（尤其是消息/事件字段）
- 新增 API 方法但未在 UI/Store 使用 → 死代码堆积

